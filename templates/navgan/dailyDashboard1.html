{% extends "navgan/base/base.html" %}

{% block title %}Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ Ù…Ø¯ÛŒØ±ÛŒØªÛŒ{% endblock %}

{% block stylesheets %}




    <style>
        .stat-card {
            background: #dfe4f5;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            font-weight: bold;
        }

        .chart-card {
            background: #fff;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .checkbox-row {
            display: flex;
            justify-content: flex-start;
            gap: 20px;
            flex-wrap: wrap;
            padding-top: 10px;
        }

        .checkbox-label {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
            user-select: none;
        }

        .checkbox-label input {
            display: none;
        }

        .checkmark {
            width: 14px;
            height: 14px;
            border-radius: 4px;
            border: 2px solid #ccc;
            display: inline-block;
            position: relative;
        }

        .checkmark::after {
            content: "";
            position: absolute;
            width: 6px;
            height: 10px;
            border: solid white;
            border-width: 0 2px 2px 0;
            transform: rotate(45deg);
            left: 3px;
            top: 1px;
            opacity: 0;
        }

        .checkbox-label input:checked + .checkmark::after {
            opacity: 1;
        }

        .check-this {
            background: #008FFB; /* Ø±Ù†Ú¯ Ø®Ø· Ø§Ù…Ø³Ø§Ù„ */
            border-color: #008FFB;
        }

        .check-last {
            background: #00E396; /* Ø±Ù†Ú¯ Ø®Ø· Ø³Ø§Ù„ Ù‚Ø¨Ù„ */
            border-color: #00E396;
        }

        /* Ø±ÛŒØ³Ù¾Ø§Ù†Ø³ÛŒÙˆ Ú†Ú©â€ŒØ¨Ø§Ú©Ø³â€ŒÙ‡Ø§ */
        @media (max-width: 576px) {
            .checkbox-row {
                gap: 10px;
            }

            .checkbox-label {
                font-size: 12px;
            }
        }

        .apexcharts-legend-series {
            margin-left: 10px !important;
        }

        .apexcharts-legend-text {
            margin-right: 6px !important;
        }

        {#*************************************************************************************#}

        /* Ú©Ø§Ø±Øª Ø³ÙÛŒØ¯ */
        .confidence-card {
            background: #ffffff;
            border-radius: 8px;
            padding: 12px 14px 10px 14px;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.08);
        }

        /* ÙÙ‚Ø· Ù†Ø§Ø­ÛŒÙ‡ Ù†Ù…ÙˆØ¯Ø§Ø± Ø³Ø¨Ø² */
        .conf-chart-wrapper {
            background: #dcefed;
            border-radius: 6px;
            padding: 8px 10px 4px 10px;
            height: 215px;
        }

        /* Ù¾Ø§ÛŒÛŒÙ† Ú©Ø§Ø±Øª */
        .conf-bottom {
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
            padding-top: 8px;
        }

        /* Ø¯Ø±ØµØ¯Ù‡Ø§ Ø³Ù…Øª Ú†Ù¾ */
        .conf-legend-left {
            display: flex;
            flex-direction: column;
            gap: 5px;
            font-weight: bold;
        }

        .conf-legend-left .item {
            display: flex;
            align-items: center;
            gap: 7px;
            font-size: 13px;
        }

        /* Ù…Ø±Ø¨Ø¹ Ø±Ù†Ú¯ */
        .box {
            width: 14px;
            height: 14px;
            border: 2px solid;
            display: inline-block;
        }

        .y1403 {
            background: #f3b21a;
            border-color: #f3b21a;
        }

        .y1404 {
            background: #546e7a;
            border-color: #546e7a;
        }

        /* Ø¹Ù†ÙˆØ§Ù† Ø±Ø§Ø³Øª Ù¾Ø§ÛŒÛŒÙ† */
        .conf-title {
            font-size: 14px;
            color: #333;
            padding-bottom: 2px;
        }

        .chart-legend-top {
            display: flex;
            justify-content: center;
            gap: 18px;
            font-size: 13px;
            font-weight: bold;
            margin-bottom: 6px;
            user-select: none;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 6px;
            cursor: pointer;
            opacity: 1;
            transition: .25s;
        }

        .legend-item.off {
            opacity: .35;
        }

        .legend-color {
            width: 18px;
            height: 10px;
            border: 2px solid;
            background: transparent;
        }

        .legend-last {
            border-color: #f3b21a;
        }

        .legend-this {
            border-color: #546e7a;
        }


        .main-chart-wrapper {
            background: #dcefed;
            border-radius: 8px;
            padding: 12px 16px 10px 8px;
            position: relative;
            height: 350px; /* Ø¯Ù‚ÛŒÙ‚Ø§Ù‹ Ø¨Ø±Ø§Ø¨Ø± Apex */
        }


        @media (max-width: 768px) {
            .main-chart-wrapper {
                height: 300px;
            }
        }


        /* ================= HEADER FILTER BAR ================= */
        /* ===== Ù†ÙˆØ§Ø± Ø¨Ø§Ù„Ø§ÛŒÛŒ ===== */

        .top-filter-outer {
            direction: rtl;
            padding: 14px 18px 0 18px;
        }

        /* Ø¨Ù†Ø± Ø¨Ù†ÙØ´ */
        .top-filter-bar {
            width: 100%;
            height: 50px;
            background: linear-gradient(90deg, #8e44ad, #9b59b6);
            border-radius: 8px;
            display: flex;
            align-items: center;
            position: relative;
            box-shadow: 0 2px 8px rgba(0, 0, 0, .18);
            padding: 0 14px;
        }

        /* Ø¹Ù†ÙˆØ§Ù† ÙˆØ³Ø· */
        .top-filter-title {
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            color: #fff;
            font-weight: bold;
            font-size: 14px;
            letter-spacing: .5px;
            white-space: nowrap;
            pointer-events: none;
        }

        /* Ø³ØªÙˆÙ† Ø±Ø§Ø³Øª */
        .top-filter-right {
            margin-left: auto; /* â¬…ï¸ Ú©Ù„ÛŒØ¯ Ø§ØµÙ„ÛŒ Ø±Ø§Ø³Øªâ€ŒÚ†ÛŒÙ† ÙˆØ§Ù‚Ø¹ÛŒ */
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* Ù„ÛŒØ¨Ù„ */
        .top-filter-label {
            color: #f1e9f8;
            font-size: 13px;
        }

        /* input ØªØ§Ø±ÛŒØ® */
        .top-filter-date {
            height: 30px;
            width: 110px;
            border-radius: 4px;
            border: none;
            outline: none;
            text-align: center;
            font-size: 12px;
        }

        .filter-btn {
            height: 30px;
            padding: 0 12px;
            background: #a07aa9; /* Ø±ÙˆØ´Ù†â€ŒØªØ± Ø§Ø² Ù‚Ø¨Ù„ÛŒ */
            color: #fff;
            border: none;
            border-radius: 4px;
            font-size: 12px;
            cursor: pointer;
            transition: .2s;
        }

        /* ÙˆÙ‚ØªÛŒ Ù…ÙˆØ³ Ù…ÛŒØ±Ù‡ Ø±ÙˆØ´ â†’ Ø¨Ø§Ø² Ù‡Ù… Ø±ÙˆØ´Ù†â€ŒØªØ± */
        .filter-btn:hover {
            background: #bcadc5;
        }


        /* Ù…ÙˆØ¨Ø§ÛŒÙ„ */
        @media (max-width: 768px) {

            .top-filter-bar {
                height: auto;
                flex-wrap: wrap;
                padding: 10px;
                justify-content: center;
                gap: 6px;
            }

            .top-filter-title {
                position: static;
                transform: none;
                width: 100%;
                text-align: center;
                margin-bottom: 6px;
            }

            .top-filter-right {
                margin-left: 0;
                justify-content: center;
                flex-wrap: wrap;
            }
        }


    </style>
{% endblock stylesheets %}


{% block content %}




    <div class="top-filter-outer account">

        <div class="top-filter-bar">

            <div class="top-filter-title">
                {{ selected_date|default:"1404-11-26" }}
            </div>

            <div class="top-filter-right">

                <span class="top-filter-label">ØªØ§Ø±ÛŒØ®</span>

                <input class="top-filter-date"
                       type="text"
                       value="{{ selected_date|default:'1404/11/26' }}" data-jdp>

                <button class="filter-btn" id="btnSearch">Ø¬Ø³ØªØ¬Ùˆ</button>
                <button class="filter-btn" id="btnLastUpdate">Ø¢Ø®Ø±ÛŒÙ† Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ</button>
                <button class="filter-btn" id="btnExport">Ø¯Ø±ÛŒØ§ÙØª Ú¯Ø²Ø§Ø±Ø´</button>

            </div>

        </div>

    </div>




    <div id="dashboardContainer">

        <div class="container-fluid mt-4 account">

            <!-- Ú©Ø§Ø±Øªâ€ŒÙ‡Ø§ÛŒ Ø¢Ù…Ø§Ø±ÛŒ -->
            <div class="row text-center mb-4">

                <div class="col-12 col-sm-4 col-md-3 col-lg-3 mb-2">
                    <div class="stat-card">ØªÙ† Ú©ÛŒÙ„ÙˆÙ…ØªØ± Ø®Ø§Ù„Øµ<br>{{ puretonkilo|floatformat:0 }}</div>
                </div>
                <div class="col-12 col-sm-4 col-md-3 col-lg-3 mb-2">
                    <div class="stat-card">ØªÙ† Ú©ÛŒÙ„ÙˆÙ…ØªØ± Ø¨Ø§Ø±Ø¯Ø§Ø±<br>{{ loadedtonkilo|floatformat:0 }}</div>
                </div>
                <div class="col-12 col-sm-4 col-md-3 col-lg-2 mb-2">
                    <div class="stat-card">Ø¶Ø±ÛŒØ¨ Ø§Ø·Ù…ÛŒÙ†Ø§Ù†<br>%{{ confidence_factor|floatformat:0 }}</div>
                </div>
                <div class="col-12 col-sm-4 col-md-3 col-lg-2 mb-2">
                    <div class="stat-card">Ø¢Ù…Ø§Ø¯Ù‡â€ŒÚ©Ø§Ø±ÛŒ<br>%{{ availability|floatformat:0 }}</div>
                </div>
                <div class="col-12 col-sm-4 col-md-3 col-lg-2 mb-2">
                    <div class="stat-card">Ø¨Ù‡Ø±Ù‡ ÙˆØ±ÛŒ<br>{{ efficiency|floatformat:0 }}</div>
                </div>

            </div>

            <!-- Ù†Ù…ÙˆØ¯Ø§Ø±Ù‡Ø§ÛŒ Ø§ØµÙ„ÛŒ -->
            <div class="row">
                <div class="col-12 col-lg-6 mb-3">
                    <div class="chart-card">
                        <h6>Ù†Ù…ÙˆØ¯Ø§Ø± Ø¹Ù…Ù„Ú©Ø±Ø¯ Ø¨Ù‡ ØªÙÚ©ÛŒÚ© Ù„Ú©ÙˆÙ…ÙˆØªÛŒÙˆ Ùˆ Ù†Ø§Ø­ÛŒÙ‡</h6>
                        <div id="barChart1"></div>
                    </div>
                </div>


                <div class="col-12 col-lg-6 mb-3">
                    <div class="chart-card">
                        <h6>Ù†Ù…ÙˆØ¯Ø§Ø± Ø¹Ù…Ù„Ú©Ø±Ø¯ Ø±ÙˆØ²Ø§Ù†Ù‡</h6>

                        <div class="main-chart-wrapper">
                            <div class="chart-legend-top" id="legend-mainChart"></div>
                            <canvas id="mainChart"></canvas>
                        </div>

                        <!-- ğŸ”½ Ø§ÛŒÙ† Ø¨Ø®Ø´ Ø¬Ø¯ÛŒØ¯ -->
                        <div class="conf-bottom mb-2">

                            <div class="conf-legend-left">
                                <div class="item">
                                    <span class="box y1403"></span>
                                    <span>{{ last_avg_tonkilo|floatformat:0 }}</span>
                                </div>

                                <div class="item">
                                    <span class="box y1404"></span>
                                    <span>{{ current_avg_tonkilo|floatformat:0 }}</span>
                                </div>
                            </div>

                            <div class="conf-title">
                                ØªÙ† Ú©ÛŒÙ„ÙˆÙ…ØªØ± Ø®Ø§Ù„Øµ
                            </div>

                        </div>
                    </div>
                </div>


            </div>

            <!-- Ù†Ù…ÙˆØ¯Ø§Ø±Ù‡Ø§ÛŒ Ù¾Ø§ÛŒÛŒÙ†ÛŒ -->
            <div class="row">
                <div class="col-12 col-md-4 mb-3">
                    <div class="confidence-card">

                        <div class="conf-chart-wrapper">
                            <div class="chart-legend-top" id="legend-efficiencyChart"></div>
                            <canvas id="efficiencyChart"></canvas>
                        </div>

                        <div class="conf-bottom ">

                            <div class="conf-legend-left ">
                                <div class="item">
                                    <span class="box y1403"></span>
                                    <span>{{ eff_last_year|floatformat:0 }} </span>
                                    <small id="effLastYear"></small>
                                </div>
                                <div class="item">
                                    <span class="box y1404"></span>
                                    <span>{{ eff_this_month|floatformat:0 }} </span>
                                    <small id="effThisYear"></small>
                                </div>
                            </div>

                            <div class="conf-title">
                                Ø¨Ù‡Ø±Ù‡â€ŒÙˆØ±ÛŒ
                            </div>

                        </div>

                    </div>
                </div>


                <div class="col-12 col-md-4 mb-3">
                    <div class="confidence-card">

                        <div class="conf-chart-wrapper">
                            <div class="chart-legend-top" id="legend-availabilityChart"></div>
                            <canvas id="availabilityChart"></canvas>
                        </div>

                        <div class="conf-bottom">

                            <div class="conf-legend-left">
                                <div class="item">
                                    <span class="box y1403"></span>
                                    <span>{{ avail_last_year|floatformat:0 }} %</span>
                                    <small id="avaLastYear"></small>
                                </div>
                                <div class="item">
                                    <span class="box y1404"></span>
                                    <span>{{ avail_this_month|floatformat:0 }} %</span>
                                    <small id="avaThisYear"></small>
                                </div>
                            </div>

                            <div class="conf-title">
                                Ø¢Ù…Ø§Ø¯Ù‡â€ŒÚ©Ø§Ø±ÛŒ
                            </div>

                        </div>

                    </div>
                </div>


                <div class="col-12 col-md-4 mb-3">
                    <div class="confidence-card">

                        <div class="conf-chart-wrapper">
                            <div class="chart-legend-top" id="legend-confidenceChart"></div>
                            <canvas id="confidenceChart"></canvas>
                        </div>

                        <div class="conf-bottom">

                            <div class="conf-legend-left">
                                <div class="item">
                                    <span class="box y1403"></span>
                                    <span id="avg1403">{{ conf_last_year|floatformat:0 }} %</span>

                                </div>
                                <div class="item">
                                    <span class="box y1404"></span>
                                    <span id="avg1404">{{ conf_this_month|floatformat:0 }} %</span>

                                </div>
                            </div>

                            <div class="conf-title">
                                Ø¶Ø±ÛŒØ¨ Ø§Ø·Ù…ÛŒÙ†Ø§Ù†
                            </div>

                        </div>

                    </div>
                </div>

            </div>

        </div>

    </div>
{% endblock content %}

{% block javascripts %}

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

    <script>
        document.addEventListener("DOMContentLoaded", function () {

            function formatNumber(value) {
                if (value === null || value === undefined) return "";
                return Math.round(value).toLocaleString('en-US');
            }

            function buildLegend(chartId, yearLast, yearThis) {

                const el = document.getElementById("legend-" + chartId);
                if (!el) return;

                el.innerHTML = `
                    <div class="legend-item" data-chart="${chartId}" data-index="1">
                        <span class="legend-color legend-last"></span>
                        ${yearLast}
                    </div>

                    <div class="legend-item" data-chart="${chartId}" data-index="0">
                        <span class="legend-color legend-this"></span>
                        ${yearThis}
                    </div>
                `;
            }


            // =====================================================
            //  Chart.js plugin -> Ø¨Ú© Ú¯Ø±Ø§Ù†Ø¯ Ø³Ø¨Ø² Ø¯Ø§Ø®Ù„ Ù†Ø§Ø­ÛŒÙ‡ Ù†Ù…ÙˆØ¯Ø§Ø±
            // =====================================================
            const chartAreaBG = {
                id: 'chartAreaBG',
                beforeDraw(chart, args, opts) {
                    const {ctx, chartArea} = chart;
                    if (!chartArea) return;

                    ctx.save();
                    ctx.fillStyle = opts.color || '#dcefed';
                    ctx.fillRect(
                        chartArea.left,
                        chartArea.top,
                        chartArea.right - chartArea.left,
                        chartArea.bottom - chartArea.top
                    );
                    ctx.restore();
                }
            };

            // =====================================================
            // 1ï¸âƒ£ BAR CHART (Apex)
            // =====================================================
            fetch("/daily-chart")
                .then(r => r.json())
                .then(data => buildBarChart(data));

            function buildBarChart(data) {

                const regionColors = {
                    19: "#F6F600", 21: "#FBDA66", 18: "#E0B801", 25: "#B4FE69",
                    10: "#33CC33", 11: "#00963F", 12: "#0A6A11", 17: "#00ccff",
                    8: "#3568FF", 16: "#0001FD", 23: "#6A1918", 20: "#C30101",
                    22: "#FB544E", 13: "#FBD2FE", 14: "#FA9FCA", 15: "#CA64A6",
                    9: "#9C34FF", 26: "#B0007D", 30: "#5E045B", 29: "#C5E3B4",
                    28: "#C8BFE7", 24: "#264478"
                };

                const series = data.regions.map(r => ({name: r.name, data: r.data}));
                const colors = data.regions.map(r => regionColors[r.code]);

                new ApexCharts(document.querySelector("#barChart1"), {
                    chart: {type: 'bar', height: 350, stacked: true, background: '#f4f6fb'},
                    series: series,
                    colors: colors,
                    dataLabels: {enabled: false},
                    xaxis: {
                        categories: data.loco_name,
                        labels: {rotate: -45, rotateAlways: true, offsetY: 12, offsetX: -8}
                    },
                    yaxis: {
                        max: data.max_number,
                        labels: {formatter: (v) => formatNumber(v)}
                    },
                    legend: {position: 'top', fontSize: '11px'}
                }).render();
            }

            // =====================================================
            // 2ï¸âƒ£ MAIN LINE (Apex)
            // =====================================================
            fetch("/daily-chartline/")
                .then(r => r.json())
                .then(data => {

                    buildLegend("efficiencyChart", data.last_year, data.year);
                    buildLegend("availabilityChart", data.last_year, data.year);
                    buildLegend("confidenceChart", data.last_year, data.year);


                    buildMainChart(data);
                    buildSmallCharts(data);

                });

            function buildMainChart(data) {

                buildLegend("mainChart", data.last_year, data.year);

                const ctx = document.getElementById("mainChart");

                charts["mainChart"] = new Chart(ctx, {
                    type: 'line',
                    plugins: [chartAreaBG],
                    data: {
                        labels: data.days,
                        datasets: [
                            {
                                label: 'Ø§Ù…Ø³Ø§Ù„',
                                data: data.pure.this,
                                borderColor: '#546e7a',
                                borderWidth: 3,
                                tension: 0.35,

                                pointRadius: 5,
                                pointHoverRadius: 7,
                                pointBackgroundColor: '#fff',
                                pointBorderColor: '#546e7a'
                            },
                            {
                                label: 'Ø³Ø§Ù„ Ù‚Ø¨Ù„',
                                data: data.pure.last,
                                borderColor: '#f3b21a',
                                borderWidth: 2,
                                tension: 0.35,

                                pointRadius: 5,
                                pointHoverRadius: 7,
                                pointBackgroundColor: '#fff',
                                pointBorderColor: '#f3b21a'
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        layout: {
                            padding: {left: 15, right: 15, top: 10, bottom: 5}
                        },

                        maintainAspectRatio: false,
                        interaction: {mode: 'index', intersect: false},
                        plugins: {
                            legend: {display: false},
                            tooltip: {
                                callbacks: {
                                    label: (ctx) => ctx.dataset.label + " : " + formatNumber(ctx.parsed.y)
                                }
                            },
                            chartAreaBG: {color: '#dcefed'}
                        },
                        scales: {
                            x: {
                                offset: true,
                                ticks: {
                                    padding: 18,
                                    maxRotation: 0,
                                    autoSkip: true,
                                    maxTicksLimit: 15
                                },
                                grid: {color: 'rgba(0,0,0,0.05)'}
                            },
                            y: {
                                grace: '8%',
                                ticks: {
                                    padding: 8,
                                    callback: (v) => formatNumber(v)
                                },
                                grid: {color: 'rgba(0,0,0,0.08)'}
                            }
                        }

                    }
                });
            }


            // =====================================================
            // 3ï¸âƒ£ SMALL CHARTS (Chart.js)
            // =====================================================
            const charts = {};

            function buildSmallCharts(data) {
                buildSmallChart("efficiencyChart", data.eff.this, data.eff.last, data.days);
                buildSmallChart("availabilityChart", data.ava.this, data.ava.last, data.days);
                buildSmallChart("confidenceChart", data.conf.this, data.conf.last, data.days);

            }

            function buildSmallChart(id, thisYear, lastYear, days) {

                const ctx = document.getElementById(id);
                if (!ctx) return;

                charts[id] = new Chart(ctx, {
                    type: 'line',
                    plugins: [chartAreaBG],
                    data: {
                        labels: days,
                        datasets: [
                            {
                                label: 'Ø§Ù…Ø³Ø§Ù„',
                                data: thisYear,
                                borderColor: '#546e7a',
                                backgroundColor: '#546e7a',
                                borderWidth: 3,
                                tension: 0.35,

                                pointRadius: 4,
                                pointHoverRadius: 6,
                                pointBorderWidth: 2,
                                pointBackgroundColor: '#ffffff',
                                pointBorderColor: '#546e7a'
                            },
                            {
                                label: 'Ø³Ø§Ù„ Ù‚Ø¨Ù„',
                                data: lastYear,
                                borderColor: '#f3b21a',
                                backgroundColor: '#f3b21a',
                                borderWidth: 2,
                                tension: 0.35,

                                pointRadius: 4,
                                pointHoverRadius: 6,
                                pointBorderWidth: 2,
                                pointBackgroundColor: '#ffffff',
                                pointBorderColor: '#f3b21a'
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        interaction: {
                            mode: 'index',
                            intersect: false
                        },
                        plugins: {
                            legend: {display: false},
                            tooltip: {
                                callbacks: {
                                    label: (ctx) => ctx.dataset.label + " : " + Math.round(ctx.parsed.y) + " %"
                                }
                            },
                            chartAreaBG: {color: '#dcefed'}
                        },
                        scales: {
                            x: {
                                ticks: {
                                    padding: 20,
                                    callback: (v, i) => days[i] % 2 === 1 ? days[i] : "",
                                    maxRotation: 45,
                                    minRotation: 45
                                },
                                grid: {color: 'rgba(0,0,0,0.08)'}
                            },
                            y: {
                                ticks: {callback: (v) => Math.round(v) + "%"},
                                grid: {color: 'rgba(0,0,0,0.08)'}
                            }
                        }
                    }
                });
            }


            // =====================================================
            // 4ï¸âƒ£ CHECKBOX CONTROL
            // =====================================================
            document.querySelectorAll('.toggleAvg').forEach(cb => {
                cb.addEventListener('change', function () {

                    const chart = charts[this.dataset.target];
                    if (!chart) return;

                    const index = this.dataset.series === "thisYear" ? 0 : 1;
                    chart.data.datasets[index].hidden = !this.checked;
                    chart.update();
                });
            });


            // =====================================================
// LEGEND CLICK (Ø¨Ø§ÛŒØ¯ Ø¯Ø§Ø®Ù„ DOMContentLoaded Ø¨Ø§Ø´Ø¯)
// =====================================================
            document.addEventListener("click", function (e) {

                const item = e.target.closest(".legend-item");
                if (!item) return;

                const chartId = item.dataset.chart;
                const datasetIndex = parseInt(item.dataset.index);

                const chart = charts[chartId];
                if (!chart) return;

                const meta = chart.getDatasetMeta(datasetIndex);

                meta.hidden = meta.hidden === null
                    ? !chart.data.datasets[datasetIndex].hidden
                    : null;

                item.classList.toggle("off");
                chart.update();
            });





        });


    </script>

{% endblock javascripts %}







